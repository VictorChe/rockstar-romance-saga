# План доработок Rock Star Romance Saga

Исходный код: [VictorChe/rockstar-romance-saga](https://github.com/VictorChe/rockstar-romance-saga). Стек: Vite, React, TypeScript; игровая логика в [src/game/](https://github.com/VictorChe/rockstar-romance-saga/tree/main/src/game) (types.ts, store.ts, constants.ts, GameScreen.tsx).

---

## 1. Форматы выступлений

Сейчас все выступления — один тип: выбор площадки (Venue) → концерт с расчётом по `capacity`, `payPerHead`, `minFame`. Нет типов «событий» (фестиваль, разогрев, сольник) и нет требований по минимальному количеству песен.

**Модель (по уточнению):** На **любой** площадке можно выступать в любом из четырёх форматов. Площадка и формат выбираются независимо: сначала выбирается площадка (бар, клуб, стадион и т.д.), затем формат выступления (слот на фестивале / хедлайнер / разогрев / сольник). Один и тот же клуб можно сыграть и как «один из многих», и как хедлайнер, и как разогрев, и как сольное выступление.

**Что сделать:**

- Ввести тип выступления (формат) как отдельную сущность, не привязанную к конкретной площадке:
  - **Участие в фестивале (слот)**: много групп, мало времени → мало известности и денег; требование: минимум 2 песни.
  - **Хедлайнер**: минимум 3 песни + известность ≥ N (константа); множители дохода/славы выше слота, но ниже сольника.
  - **Разогрев артиста**: мало времени, мало известности, средне денег; минимум 5 песен.
  - **Сольное выступление**: много времени, много известности, много денег; минимум 10 песен.

Реализация:

- В [src/game/types.ts](src/game/types.ts): ввести тип `GigFormat` (или enum) и интерфейс описания формата: id, название, minSongs, minFame (опционально, для хедлайнера), множители pay и fame. Площадка (`Venue`) остаётся без привязки к формату.
- В [src/game/constants.ts](src/game/constants.ts): массив/объект форматов `GIG_FORMATS` с параметрами для каждого из четырёх форматов.
- В [src/game/store.ts](src/game/store.ts): сигнатура `playConcert(venueId, gigFormatId)` — по формату проверять minSongs и minFame; базовый расчёт по площадке (capacity, payPerHead), затем применять множители формата к earnings и fameGained.
- В UI ([GameScreen.tsx](src/game/GameScreen.tsx), экран бронирования): для каждой площадки показывать выбор формата (четыре кнопки/опции). Для выбранной пары «площадка + формат» показывать требования (минимум песен, мин. известность для хедлайнера) и блокировать «Играть», если не выполнены, с подсказкой.

Итог: на любой площадке доступны все четыре формата; выбор площадки и формата независимы; у каждого формата свои minSongs, при необходимости minFame, и свои множители дохода/славы.

---

## 2. Заработок при нуле денег и пассивный доход

Сейчас: в [store.ts](src/game/store.ts) после концерта вычитаются расходы и зарплаты; баланс может уйти в минус. Альбомы дают доход только в момент концерта (цикл по `state.albums` в `playConcert`), а не каждую неделю отдельно.

**Что сделать:**

- **Запрет ухода в минус**: при расчёте недельных расходов (зарплаты + база) и при любом списании (репетиция, студия, магазин) ограничивать: если после операции `money < 0`, либо не выполнять действие и показать сообщение «Недостаточно денег», либо капнуть деньги на 0 и завести отдельный флаг/состояние «долг» (опционально). Рекомендация: просто не давать уходить в минус (отмена действия + тост).
- **Альтернативные заработки (если денег нет или мало):**
  - **Уличное выступление**: действие «Выступить на улице». Доход зависит от известности (мало), можно разрешить одному участнику (или соло). Не требует площадки из списка. Добавить в store функцию `performStreetGig()` и в UI кнопку/экран (например, в HQ или в разделе «Концерт» как отдельный тип).
  - **Радио**: выступление/интервью на радио — фиксированный или зависящий от известности доход, плюс небольшой бонус к славе. Функция `doRadioShow()` и пункт в меню.
  - **Интервью**: отдельное действие — деньги и/или слава. Функция `doInterview()` и пункт в меню.
- **Альбомы — еженедельный доход**: перенести логику продаж альбомов из блока «после концерта» в отдельный еженедельный шаг. Варианты:
  - Вызывать расчёт продаж альбомов в `advanceWeek()` (и при смене недели после концерта не дублировать продажи, а вызывать общий «тик недели»).
  - Либо оставить смену недели только в `playConcert`, но ввести `processWeekEnd()`: расходы, зарплаты, продажи альбомов, восстановление стамины — и вызывать его и после концерта, и при «Пропустить неделю».

Итог: деньги не уходят в минус; есть уличное выступление (в т.ч. соло), радио, интервью; альбомы приносят деньги каждую неделю.

---

## 3. Больше инструментов и оборудования. Требования площадок

Сейчас: в [types.ts](src/game/types.ts) есть `Equipment` (instrument, amp, mic, drums, keys, pa, lights) и каталог в constants; площадки не требуют конкретного оборудования или инструментов.

**Что сделать:**

- Расширить каталог в [constants.ts](src/game/constants.ts): добавить больше позиций инструментов и оборудования (гитары, басы, барабаны, клавиши, микрофоны, усилители, PA, свет), сохраняя структуру `Equipment`.
- В типах для площадки/выступления задать требования:
  - В `Venue` (или в `GigType`) добавить поля, например: `requiredEquipmentIds?: string[]` (например, pa-mid, mic-mid) и/или `requiredInstrumentSlots?: InstrumentType[]` (чтобы на площадке «нельзя без барабанов»).
- В [store.ts](src/game/store.ts) при проверке «можно ли играть концерт»: проверять наличие в `state.equipment` всех `requiredEquipmentIds` и наличие участников/инструментов под `requiredInstrumentSlots`. Если чего-то нет — возвращать ошибку с текстом, чего не хватает.
- В UI при выборе площадки показывать список требований (оборудование/инструменты) и помечать невыполненные.

Итог: больше предметов в магазине; у площадок/форматов — жёсткие требования по оборудованию/инструментам; без них выступление недоступно.

---

## 4. Найм немузкантов (менеджер, техник, звуковик)

Сейчас: в игре только персонажи-музыканты (`Character` с `instrument` и `salary`); найм только через `hireMember` из пула музыкантов.

**Что сделать:**

- В [types.ts](src/game/types.ts) ввести роли помимо музыканта, например:
  - Расширить `Character` полем `role: 'musician' | 'manager' | 'sound_engineer' | 'tech'` (или вынести «персонаж команды» с ролями, а музыканты — подмножество с `instrument`).
  - Либо отдельный тип `CrewMember`: id, name, role, salary, эффекты (множитель гонорара/славы, допуск на площадки).
- Эффекты ролей (задать в constants и применять в store):
  - **Менеджер**: организует концерты выгоднее (множитель к earnings и/или к fame для концертов) и/или открывает более «выгодные» офферы.
  - **Техник / звуковик**: улучшает звук (бонус к качеству выступления / crowdMood или к требованию оборудования — например, считаться что часть оборудования «есть» за счёт техника). На части площадок без звуковика/техника нельзя выступать — добавить в требования площадки `requiresSoundEngineer?: boolean` и т.п.
- В [store.ts](src/game/store.ts): при расчёте концерта учитывать наличие менеджера (множитель дохода/славы); при проверке допуска на площадку проверять наличие звуковика/техника, если они обязательны.
- В [constants.ts](src/game/constants.ts): пул имён для менеджеров/звуковиков/техников (аналогично `MUSICIAN_NAMES`).
- В [GameScreen.tsx](src/game/GameScreen.tsx) (раздел «Состав» или новый «Команда»): список участников группы с разделением на музыкантов и немузкантов; кнопка «Нанять менеджера/звуковика/техника» и отображение их эффектов.

Итог: можно нанимать менеджера, техника, звуковика; они влияют на гонорары/славу и на допуск на часть площадок.

---

## 5. Друзья-музыканты вместо профи

Сейчас: найм только платных музыкантов с фиксированной зарплатой; уволить — убрать из состава.

**Что сделать:**

- В [types.ts](src/game/types.ts) у `Character` добавить флаг `isPro?: boolean` (или `contract: 'pro' | 'friend'`). «Друг»: salary = 0, но доля с концерта; навыки в среднем ниже, чем у профи.
- Генерация пула:
  - В [store.ts](src/game/store.ts) при генерации пула нанимаемых различать: профи (как сейчас) и друзья (отдельная функция `generateFriendPool()` или флаг в `generateHirePool()`). У друзей: skill/creativity ниже (например, ограничить сверху 50–60), salary = 0.
- Оплата друзьям:
  - При расчёте концерта: если в группе есть «друзья», после расчёта earnings выделить им долю (например, X% от гонорара делить между друзьями). Правило: «не позволяя уйти в минус» — значит доля друзьям вычитается из earnings, но итоговый баланс группы не должен стать отрицательным: либо `money_after = max(0, money + earnings - friendShare)`, а друзьям выплатить только то, что не уводит в минус (остаток «в долг» не давать или копить до следующего концерта), либо просто ограничить friendShare величиной `earnings` и не трогать остальные расходы.
- В UI: в разделе найма показывать два варианта — «Нанять профессионала» (зарплата в неделю) и «Позвать друга» (без оклада, доля с концерта); отображать у друга пометку «доля с концерта» и более низкий скилл.

Итог: можно звать друзей-музыкантов без оклада, с долей с концерта; их скилл слабее; баланс не уходит в минус из-за выплаты доли.

---

## Порядок внедрения и зависимости

- Рекомендуемый порядок: (1) расширить типы и константы под все пункты; (2) форматы выступлений (1); (3) запрет минуса и альтернативные заработки + еженедельные альбомы (2); (4) оборудование и требования площадок (3); (5) роли менеджер/звуковик/техник (4); (6) друзья-музыканты (5).

---

## Уточнения

- **Форматы на любой площадке**: на любой площадке можно выступать и как хедлайнер, и как разогрев, и как один из многих (слот), и как сольный артист; выбор площадки и формата независимы.
- **Значение N для хедлайнера**: задать в константах (например, minFameHeadline = 100) и при необходимости балансировать.
- **«На улице можно одному»**: для уличного выступления разрешить 1 участника.
- **Доля друзьям**: конкретный % (например, 15–25% с концерта на всех друзей вместе) вынести в constants и при необходимости балансировать.
